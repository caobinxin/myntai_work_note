bochs 调试

bochs下调试com文件方法：
方法一：在你的程序 LABEL_BEGIN后面紧接着写一个jmp $（让代码死循环在这个位置），然后编译为com文件。写入虚拟软盘。
之后启动调试模式的bochs，先不要设置任何断点，直接执行到dos界面。然后在dos中运行你的程序，出现假死状态（必然的，程序一开始就会死循环）。
然后切换到bochs的命令行窗口，估计需要先按ctrl+c,然后输入r命令，察看当前eip寄存器的值。例如当前值为0x124,那么就输入下面的命令，set \$eip=0x126,就是让EIP增大2即可，JMP \$的机器码要占这么个大小。之后，就可以单步跟踪执行了

##### 魔术断点调试

方法二：先在bochs的配置文件中加入一句话”magic_break: enabled=1”,这句话的作用就是bochs启动时开启魔术断点调试功能，然后在程序开始处添加一句xchg bx,bx。

将com文件复制到虚拟软盘pm.img中，启动bochs在freedos中运行com文件，当执行到xchg bx,bx指令时就会自动断到Bochsdbg里。

用这种方式去调试，汇编很爽

```shell
#=======================================================================

MAGIC_BREAK:

This enables the "magic breakpoint" feature when using the debugger.

The useless cpu instruction XCHG BX, BX causes Bochs to enter the

debugger mode. This might be useful for software development.

#

Example:

magic_break: enabled=1

#======================================================================
```

正如这个配置名字所描述的那样magic，真正做到任意断点调试！

如果是GCC的嵌入汇编可以这样写：

```c
__asm__("xchg %%bx,%%bx"::);
```

