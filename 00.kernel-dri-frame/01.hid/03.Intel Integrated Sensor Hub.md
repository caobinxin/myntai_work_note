03.Intel Integrated Sensor Hub(ISH)

Intel集成传感器集线器



传感器集线器能够将传感器轮询和算法处理卸载到专用的低功耗协处理器。这允许核心处理器更频繁地进入低功耗模式，从而延长电池寿命。

有许多供应商提供外部传感器集线器，以确认HID传感器使用表，并用于多个平板电脑、2/1可转换笔记本电脑和嵌入式产品。Linux从Linux3.9开始就有这种支持。



Intel®推出了集成传感器集线器，作为SoC的一部分，从Cherry Trail开始，现在支持多代CPU软件包。已经有许多商用设备与集成传感器集线器（ISH）一起提供。这些ISH也符合HID传感器规格，但区别在于用于通信的传输协议。当前的外部传感器集线器主要使用I2c或USB上的HID。但ISH既不使用I2c也不使用USB。

## 1. Overview

通过与USBHID实现的类比，ISH对非常高速的通信采用类似的模型：

```shell
-----------------               ----------------------
|    USB HID    |       -->     |    ISH HID         |
-----------------               ----------------------
-----------------               ----------------------
|  USB protocol |       -->     |    ISH Transport   |
-----------------               ----------------------
-----------------               ----------------------
|  EHCI/XHCI    |       -->     |    ISH IPC         |
-----------------               ----------------------
      PCI                                PCI
-----------------               ----------------------
|Host controller|       -->     |    ISH processor   |
-----------------               ----------------------
     USB Link
-----------------               ----------------------
| USB End points|       -->     |    ISH Clients     |
-----------------               ----------------------
```

与USB协议提供设备枚举、链路管理和用户数据封装的方法一样，ISH也提供类似的服务。但它是非常轻的重量定制来管理和与在固件中实现的ISH客户机应用程序通信。

ISH允许在固件中执行多个传感器管理应用程序。与USB端点一样，消息可以发送到/来自客户机。作为枚举过程的一部分，将标识这些客户机。这些客户机可以是简单的HID传感器应用程序、传感器校准应用程序或传感器固件更新应用程序。
实现模型与USB总线类似，ISH传输也实现为总线。在ISH处理器中执行的每个客户机应用程序都注册为此总线上的设备。绑定每个设备的驱动程序（ISH HID驱动程序）标识设备类型并向HID核心注册。

## 2. ISH Implementation: Block Diagram

```c
       ---------------------------
      |  User Space Applications  |
       ---------------------------

----------------IIO ABI----------------
       --------------------------
      |  IIO Sensor Drivers     |
       --------------------------
       --------------------------
      |        IIO core         |
       --------------------------
       --------------------------
      |   HID Sensor Hub MFD    |
       --------------------------
       --------------------------
      |       HID Core          |
       --------------------------
       --------------------------
      |   HID over ISH Client   |
       --------------------------
       --------------------------
      |   ISH Transport (ISHTP) |
       --------------------------
       --------------------------
      |      IPC Drivers        |
       --------------------------
OS
---------------- PCI -----------------
Hardware + Firmware
       ----------------------------
      | ISH Hardware/Firmware(FW) |
       ----------------------------

```

