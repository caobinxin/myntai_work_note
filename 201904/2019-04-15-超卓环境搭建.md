# 凤凰操作环境的搭建



## 1. 公司其他相关

### 1.1 邮箱

caobinxin@phoenixos.com

用户名：caobinxin

密码: 123qweasd.

http://mail.phoenixos.com/alimail/#h=WyJmbV8yIixbIjIiLCIiLHsiZklkIjoiMiIsInNlbElkIjoiMl8wOkR6enp6eVhILWdQJC0tLS5FTFJ4cHVBIiwib2Zmc2V0IjowLCJyZyI6W1siMiIseyJpZCI6Im0hMl8wOkR6enp6eVhILWdQJC0tLS5FTFJ4cHVBIiwic2YiOjB9XV19LHsibGFiZWwiOiLpgq7ku7YifV1d



wifi 密码：d9dgrsjh.

## 2. 业务相关

### 2.1 代码拉取：

```shell
repo init --repo-url git://aosp.chaozhuo.org/git-repo -u ssh://caobinxin@gerrit.chaozhuo.org:29418/x86manifest -b phoenix-n


repo init --repo-url git://aosp.chaozhuo.org/git-repo -u ssh://caobinxin@gerrit.chaozhuo.org:29418/x86manifest -b phoenix-n

#以后就用这个
 repo init --repo-url git://aosp.chaozhuo.org/git-repo -u ssh://caobinxin@192.168.1.112:29418/x86manifest -b phoenix-n

#拉取代码
repo sync -j8
```

### 2.2 编译前环境搭建：



android官方　源码变异环境指导安装：https://source.android.com/source/initializing.html

```shell
「秦少辉: android官网有些android编译时需要的工具。我也好久没更新了，你参考下

sudo apt-get install p7zip-full syslinux-utils python-networkx python-mako
sudo apt-get install git gnupg flex bison gperf build-essential zip curl libc6-dev libncurses5-dev:i386 x11proto-core-dev libx11-dev:i386 libreadline6-dev:i386 libgl1-mesa-dev g++-multilib mingw32 tofrodos python-markdown libxml2-utils xsltproc zlib1g-dev:i386 yasm

sudo apt-get install git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev ccache libgl1-mesa-dev libxml2-utils xsltproc unzip
```

在安装 libreadline6-dev:i386 和　mingw32　时报错

错误解决参照：https://blog.csdn.net/u011596455/article/details/53267009

```
sudo gedit /etc/apt/sources.list
//在sources.list末尾添加，保存
deb http://us.archive.ubuntu.com/ubuntu trusty main universe
sudo apt-get update
sudo apt-get install mingw32
sudo apt-get install libreadline6-dev:i386
```

再次安装即可安装成功

安装jdk

```shell
sudo apt-get update
sudo apt-get install openjdk-8-jdk
```

解决缺少依赖项的问题：

```shell
sudo apt-get -f install 
```

### 2.3 源码编译指令

```shell
source build/envsetup.sh;
lunch android_x86_64-userdebug;
make iso_img -j8;
```



#### 2.3.1 编译记录

https://www.twblogs.net/a/5b844d572b71775d1cd031c0/zh-cn

在我修复的过程中，有时候执行make命令会报同样的错，这个时候我通常执行make clobber命令清除之前编译生成的环境和文件，全部重新执行生效。

```shell
make clobber
```

##### 错误1

描述：

```shell
[  1% 604/52809] Lex: aidl <= system/tools/aidl/aidl_language_l.ll
FAILED: /bin/bash -c "prebuilts/misc/linux-x86/flex/flex-2.5.39 -oout/host/linux-x86/obj/STATIC_LIBRARIES/libaidl-common_intermediates/aidl_language_l.cpp system/tools/aidl/aidl_language_l.ll"
flex-2.5.39: loadlocale.c:130:_nl_intern_locale_data: ?? 'cnt < (sizeof (_nl_value_type_LC_TIME) / sizeof (_nl_value_type_LC_TIME[0]))' ???
Aborted (core dumped)

```

解决的办法：

修复:

在build/envsetup.sh脚本中最后添加一句话

```
export LC_ALL=C
```

这里需要从build/envsetup.sh重新执行

参考链接：<https://stackoverflow.com/questions/49955137/error-when-build-lineageos-make-ninja-wrapper-error-1>



最后编译成功：

```shell
out/target/product/x86_64/android_x86_64.iso is built successfully.


#### make completed successfully (01:41:53 (hh:mm:ss)) ####

colby@pc:~/androidos$ 

```

### 2.4 运行

进入/home/colby/androidos/out/target/product/x86_64

```shell
x86_64$ ll *.img
-rw-r--r-- 1 colby colby    4342235 Apr 15 19:09 initrd.img
-rw-r--r-- 1 colby colby    5199430 Apr 15 18:53 install.img
-rw-r--r-- 1 colby colby    1749354 Apr 15 18:53 ramdisk.img
-rw-r--r-- 1 colby colby 2097152000 Apr 15 19:09 system.img

x86_64$ ls kernel 
kernel
```

将这五个文件放置到windows的c盘底下的　PhoenicOS目录中：

#### 2.4.1 uefi 安装

注意点：如果是uefi这种新的bios启动的话，需要我们额外的关注一下 kernel 和　initrd.img 两个文件的放置位置

1. 首先在windows底下用命令行**超级用户**
2. 运行：powershell
3. 运行：mountvol.exe z: /S
4. z:
5. ls
6. cd .\EFI\
7. dir
8. cd .\PhoenixOS\
9. dir
10. c:\PhoenixOS\kernel 

将我们的kernel 和 initrd.img放置到EFI目录下面的PhoenixOS中即可



首先到达EFI/PhoenixOS 目录下执行复制 拷贝

copy C:\PhoenixOS\caobinxin.txt .\ 

rm caobinxin.txt



### 2.5 smb:

```shell
smb://192.168.1.112/temp/0429/kernel.zip
```



### 2.6 公司翻墙

这个是服务器端，需要参照这个配置客户端

![](/home/colby/work/myntai_work_note/201904/2019-04-15-超卓环境搭建.assets/公司翻墙.png)

```c
「华硕: 端口10924, d9dgrsjh 」
—————————
「华硕: 45.78.8.254」
—————————
「华硕: 这是server端的配置，你对应配置client端的参数吧。」
—————————
```